(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["message"],{"083a":function(t,a,i){"use strict";var e=i("0d51"),s=TypeError;t.exports=function(t,a){if(!delete t[a])throw s("Cannot delete property "+e(a)+" of "+e(t))}},"3c65":function(t,a,i){"use strict";var e=i("23e7"),s=i("7b0b"),n=i("07fa"),r=i("3a34"),o=i("083a"),c=i("3511"),l=1!==[].unshift(0),u=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(t){return t instanceof TypeError}},d=l||!u();e({target:"Array",proto:!0,arity:1,forced:d},{unshift:function(t){var a=s(this),i=n(a),e=arguments.length;if(e){c(i+e);var l=i;while(l--){var u=l+e;l in a?a[u]=a[l]:o(a,u)}for(var d=0;d<e;d++)a[d]=arguments[d]}return r(a,i+e)}})},"59cf":function(t,a,i){},"5b3b":function(t,a,i){"use strict";i("93ea")},"64a8":function(t,a,i){"use strict";a["a"]=function(t=null){return{data(){return{isLoading:!0,data:t}},async created(){this.data=await this.fetchData(),this.isLoading=!1}}}},"684a":function(t,a,i){"use strict";var e=function(){var t=this,a=t._self._c;return a("div",{staticClass:"message-area-container"},[a("div",{staticClass:"data-form-container"},[a("DataForm",t._g({},t.$listeners))],1),a("h3",[t._v(" "+t._s(t.title)+" "),a("span",[t._v(t._s(t.subTitle))])]),a("div",{staticClass:"data-list-container"},[a("DataList",{attrs:{list:t.list}})],1),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isListLoading,expression:"isListLoading"}],staticClass:"loading"})])},s=[],n=function(){var t=this,a=t._self._c;return a("form",{ref:"form",staticClass:"data-form-container",on:{submit:function(a){return a.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[a("div",{staticClass:"form-item"},[a("div",{staticClass:"input-area"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.nickname,expression:"formData.nickname"}],attrs:{type:"text",maxlength:"10",placeholder:"用户昵称"},domProps:{value:t.formData.nickname},on:{input:function(a){a.target.composing||t.$set(t.formData,"nickname",a.target.value)}}}),a("span",{staticClass:"tip"},[t._v(t._s(t.formData.nickname.length)+"/10")])]),a("div",{staticClass:"error"},[t._v(t._s(t.error.nickname))])]),a("div",{staticClass:"form-item"},[a("div",{staticClass:"text-area"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.formData.content,expression:"formData.content"}],attrs:{maxlength:"300",placeholder:"输入内容"},domProps:{value:t.formData.content},on:{input:function(a){a.target.composing||t.$set(t.formData,"content",a.target.value)}}}),a("span",{staticClass:"tip"},[t._v(t._s(t.formData.content.length)+"/300")])]),a("div",{staticClass:"error"},[t._v(t._s(t.error.content))])]),a("div",{staticClass:"form-item"},[a("div",{staticClass:"button-area"},[a("button",{attrs:{disabled:t.isSubmiting}},[t._v(" "+t._s(t.isSubmiting?"提交中...":"提交")+" ")])])])])},r=[],o={data(){return{formData:{nickname:"",content:""},error:{nickname:"",content:""},isSubmiting:!1}},methods:{handleSubmit(){this.error.nickname=this.formData.nickname?"":"请填写昵称",this.error.content=this.formData.content?"":"请填写内容",this.error.nickname||this.error.content||(this.isSubmiting=!0,this.$emit("submit",this.formData,t=>{this.$showMessage({content:t,type:"success",duration:1e3,container:this.$refs.form,callback:()=>{this.isSubmiting=!1,this.formData.nickname="",this.formData.content=""}})}))}}},c=o,l=(i("5b3b"),i("2877")),u=Object(l["a"])(c,n,r,!1,null,"a4b77b2a",null),d=u.exports,f=function(){var t=this,a=t._self._c;return a("ul",{staticClass:"data-list-container",attrs:{id:"data-list-container"}},t._l(t.list,(function(i){return a("li",{key:i.id},[a("Avatar",{attrs:{url:i.avatar,size:44}}),a("div",{staticClass:"data"},[a("div",{staticClass:"nickname"},[t._v(t._s(i.nickname))]),a("div",{staticClass:"content"},[t._v(" "+t._s(i.content)+" ")]),a("div",{staticClass:"time"},[t._v(t._s(t.formatDate(i.createDate,!0)))])])],1)})),0)},m=[],h=i("2095"),p=i("df3a"),v={components:{Avatar:p["a"]},props:{list:{type:Array,default:()=>[]}},methods:{formatDate:h["a"]}},b=v,g=(i("b39e"),Object(l["a"])(b,f,m,!1,null,"0b7db5f2",null)),_=g.exports,S={components:{DataList:_,DataForm:d},props:{title:{type:String,default:""},subTitle:{type:String,default:""},list:{type:Array,default:()=>{}},isListLoading:{type:Boolean,default:!1}}},D=S,w=(i("fb5a"),Object(l["a"])(D,e,s,!1,null,"309500dd",null));a["a"]=w.exports},"6a59":function(t,a,i){},"8eef":function(t,a,i){"use strict";i("59cf")},"8fc4":function(t,a,i){"use strict";i.r(a);var e=function(){var t=this,a=t._self._c;return a("div",{ref:"mainContainer",staticClass:"message-container"},[a("MessageArea",{attrs:{title:"留言板",subTitle:`(${t.data.total})`,isListLoading:t.isLoading,list:t.data.rows},on:{submit:t.handleSubmit}})],1)},s=[],n=(i("3c65"),i("684a")),r=i("64a8"),o=i("e5d3"),c=i("0c6d");async function l(t=1,a=10){return await c["a"].get("/api/message",{params:{page:t,limit:a}})}async function u(t){return await c["a"].post("/api/message",t)}var d={data(){return{page:1,limit:10}},mixins:[Object(r["a"])({total:0,rows:[]}),Object(o["a"])("mainContainer")],components:{MessageArea:n["a"]},computed:{hasMore(){return this.data.rows.length<this.data.total}},created(){this.$bus.$on("mainScroll",this.handleScroll)},destoryed(){this.$bus.$off("mainScroll",this.handleScroll)},methods:{async fetchData(){return await l(this.page,this.limit)},async handleSubmit(t,a){const i=await u(t);this.data.rows.unshift(i),this.data.total++,a("感谢您的留言")},handleScroll(t){if(this.isLoading||!t)return;const a=100,i=Math.abs(t.scrollTop+t.clientHeight-t.scrollHeight);i<=a&&this.fetchMore()},async fetchMore(){if(!this.hasMore)return;this.isLoading=!0,this.page++;const t=await l(this.page,this.limit);this.data.rows=this.data.rows.concat(t.rows),this.isLoading=!1}}},f=d,m=(i("8eef"),i("2877")),h=Object(m["a"])(f,e,s,!1,null,"77db6fc3",null);a["default"]=h.exports},"93ea":function(t,a,i){},b39e:function(t,a,i){"use strict";i("6a59")},c859:function(t,a,i){},e5d3:function(t,a,i){"use strict";a["a"]=function(t){return{mounted(){this.$refs[t].addEventListener("scroll",this.handleMainScroll),this.$bus.$on("setMainScroll",this.handleSetMainScroll)},beforeDestroy(){this.$bus.$emit("mainScroll"),this.$bus.$off("setMainScroll",this.handleSetMainScroll),this.$refs[t].removeEventListener("scroll",this.handleMainScroll)},methods:{handleSetMainScroll(a){this.$refs[t].scrollTop=a},handleMainScroll(){this.$bus.$emit("mainScroll",this.$refs[t])}}}}},fb5a:function(t,a,i){"use strict";i("c859")}}]);